<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>canvas-é¾™</title>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>
    <script>
        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext("2d");
        const image = new Image();
        // function imageFn () {
            image.src = "./img/drang.png";
            // image.src = "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8098e5ef8d6b46288cfd2292dccc2b65~tplv-k3u1fbpfcp-watermark.image";
            image.onload = function() {
                canvas.width = image.width;
                canvas.height = image.height;
                ctx.drawImage(image, 0, 0);
                darftImage();
            }
            // return 'test';
        // }

        function darftImage () {
            let imageData = ctx.getImageData(0, 0, image.width, image.height).data;
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, image.width, image.height);
            let gap = 6;
            // for (let h = 0; h < image.height; h += gap) {
            //     for (let w = 0; w < image.width; w += gap) {
            //         let position = (image.width * h + w) * 4;
            //         var r = imageData[position], g = imageData[position + 1], b = imageData[position + 2];
            //         // console.log(r,g,b)
            //         if (r + g + b == 0) {
            //             console.log('1')
            //             ctx.fillStyle = "#000";
            //             ctx.fillRect(w, h ,4, 4);
            //         }
            //     }
            // }
            for (var h = 0; h < image.height; h+=gap) {
                for(var w = 0; w < image.width; w+=gap){
                        var position = (image.width * h + w) * 4;
                        var r = imageData[position], g = imageData[position + 1], b = imageData[position + 2];

                    if(r+g+b < 500){
                        ctx.fillStyle = "#000";
                        ctx.fillRect(w,h,4,4);
                    }
                }
            }
        }
        // async function loading () {
        //     let a = await imageFn();
        //     console.log(a ,image.width, image.height)
        //     // darftImage();
        // }

        // loading();
        // setTimeout(() => {
        //     console.log(image.width, image.height)
        // }, 1000);
    </script>
</html>